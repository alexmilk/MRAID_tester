<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MRAID Test Harness</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f8f8f8;
      margin: 0; padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #ad-container {
      width: 320px; 
      height: 480px; 
      border: 2px solid #333;
      margin: 20px;
      background: white;
      position: relative;
      overflow: hidden;
    }
    iframe {
      width: 100%;
      height: 100%;
      border: none;
      background: white;
    }
    #log {
      width: 90%;
      height: 200px;
      overflow-y: auto;
      background: black;
      color: lime;
      padding: 8px;
      font-family: monospace;
    }
    textarea {
      width: 90%;
      height: 200px;
      margin: 10px 0;
      font-family: monospace;
    }
    button {
      padding: 8px 16px;
      margin: 8px;
      border: none;
      background: #333;
      color: white;
      cursor: pointer;
      border-radius: 6px;
    }
    button:hover {
      background: #555;
    }
  </style>
</head>
<body>
  <h2>MRAID Test Harness</h2>

  <textarea id="creativeHtml" placeholder="Paste your ADM / HTML creative here"></textarea><br>
  <button onclick="loadCreative()">Render Creative</button>

  <div id="ad-container">
    <iframe id="creativeFrame"></iframe>
  </div>

  <h3>Debug Log</h3>
  <div id="log"></div>

  <script>
    // Logger helper
    function log(msg) {
      console.log(msg);
      const logBox = document.getElementById("log");
      logBox.innerHTML += msg + "<br>";
      logBox.scrollTop = logBox.scrollHeight;
    }

    // Fallback stub if no SDK provides mraid.js
    if (typeof window.mraid === "undefined") {
      window.mraid = {
        getState: () => "default",
        isViewable: () => true,
        getPlacementType: () => "inline",
        open: (url) => log("MRAID.open called with: " + url),
        close: () => log("MRAID.close called"),
        expand: () => log("MRAID.expand called"),
        resize: () => log("MRAID.resize called"),
        playVideo: (url) => log("MRAID.playVideo called with: " + url),
        addEventListener: (ev, fn) => log("Listener added: " + ev),
      };
      log("‚ö†Ô∏è Injected stub mraid.js (since no SDK provided one)");
    }

    // Inject debug hooks
    (function attachMraidDebugger() {
      const methods = ["open","close","expand","resize","playVideo","storePicture"];
      methods.forEach(fn => {
        if (typeof mraid[fn] === "function") {
          const orig = mraid[fn];
          mraid[fn] = function() {
            log(`üì¢ MRAID.${fn} called with args: ${JSON.stringify([...arguments])}`);
            return orig.apply(this, arguments);
          }
        }
      });
      const events = ["ready","error","stateChange","viewableChange","sizeChange"];
      events.forEach(ev => {
        try {
          mraid.addEventListener(ev, function() {
            log(`üì¢ MRAID event fired: ${ev} ${JSON.stringify([...arguments])}`);
          });
        } catch(e) {
          log("Error attaching event: " + ev);
        }
      });
      log("‚úÖ MRAID Debugger attached");
    })();

    // Load creative from textarea into iframe
    function loadCreative() {
      const creativeHtml = document.getElementById("creativeHtml").value;
      if (!creativeHtml) return alert("Paste creative HTML first.");
      const iframe = document.getElementById("creativeFrame");
      const doc = iframe.contentDocument || iframe.contentWindow.document;
      doc.open();
      doc.write(creativeHtml);
      doc.close();
      log("üñºÔ∏è Creative rendered into iframe");
    }
  </script>
</body>
</html>
